<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>diff_drive: joints_receive_from_arduino.py Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="jquery.js"></script>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_53e6fa9553ac22a5646d2a2b2d7b97a1.html">scripts</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">joints_receive_from_arduino.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="joints__receive__from__arduino_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespacejoints__receive__from__arduino.html">    1</a></span>&#160;<span class="comment">#!/usr/bin/env python</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">#encoding: utf8</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">import</span> rospy</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">#from rospy_tutorials.msg import Floats</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">from</span> sensor_msgs.msg <span class="keyword">import</span> JointState</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"># &lt;packagename&gt;.srv</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">from</span> diff_drive.srv <span class="keyword">import</span> joint_state, joint_stateResponse</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"># from Float_array.srv import Floats_array, Float_arrayResponse, Float_arrayRequest</span></div><div class="line"><a name="l00009"></a><span class="lineno"><a class="line" href="classjoints__receive__from__arduino_1_1Wheel__state.html">    9</a></span>&#160;<span class="keyword">class </span><a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html">Wheel_state</a>(object):</div><div class="line"><a name="l00010"></a><span class="lineno"><a class="line" href="classjoints__receive__from__arduino_1_1Wheel__state.html#af88751bc8cd5fcfd4d87268b4781a7a2">   10</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html#af88751bc8cd5fcfd4d87268b4781a7a2">__init__</a>(self):    </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        rospy.init_node(<span class="stringliteral">&quot;wheel_states&quot;</span>)</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;        nodename = rospy.get_name()</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        rospy.loginfo(<span class="stringliteral">&quot;%s started&quot;</span> % nodename)</div><div class="line"><a name="l00014"></a><span class="lineno"><a class="line" href="classjoints__receive__from__arduino_1_1Wheel__state.html#a4715509e5c522908410eee97a6267317">   14</a></span>&#160;        self.<a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html#aa20810461ad5601538d8c19e58c0c227">pos0</a>=self.<a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html#a4715509e5c522908410eee97a6267317">pos1</a>=0        </div><div class="line"><a name="l00015"></a><span class="lineno"><a class="line" href="classjoints__receive__from__arduino_1_1Wheel__state.html#a236f5e16a2e10b4461011a862a245eda">   15</a></span>&#160;        self.<a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html#a5b5c162bf840b6a0326d1caf18f1d473">vel0</a>=self.<a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html#a236f5e16a2e10b4461011a862a245eda">vel1</a>=0       </div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;        rospy.Subscriber(<span class="stringliteral">&quot;/joint1_states_from_arduino&quot;</span>, JointState, self.<a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html#a53794f24feed2a9458936721af719988">joint1_callback</a>, queue_size=10)</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        <span class="comment">#rospy.Subscriber(&quot;/joint2_states_from_arduino&quot;, Floats, self.joint2_callback, queue_size=10)</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno"><a class="line" href="classjoints__receive__from__arduino_1_1Wheel__state.html#a53794f24feed2a9458936721af719988">   19</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html#a53794f24feed2a9458936721af719988">joint1_callback</a>(self, msg):        </div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;        <span class="comment">#self.pos[0]=msg.data[0]</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        <span class="comment">#self.vel[0]=msg.data[1]</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;        self.<a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html#aa20810461ad5601538d8c19e58c0c227">pos0</a>=msg.position[0]</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        self.<a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html#a5b5c162bf840b6a0326d1caf18f1d473">vel0</a>=msg.velocity[0]</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        self.<a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html#a4715509e5c522908410eee97a6267317">pos1</a>=msg.position[1]</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        self.<a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html#a236f5e16a2e10b4461011a862a245eda">vel1</a>=msg.velocity[1]  </div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        <span class="comment">#print &quot;Pos: &quot;, pos, &quot;vel: &quot;, vel</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        <span class="comment">#rospy.loginfo(rospy.get_caller_id() + &quot;I heard %s&quot;, msg)</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;             </span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="stringliteral">    def joint2_callback(self, msg):        </span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="stringliteral">        self.pos[1]=msg.data[0]</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="stringliteral">        self.vel[1]=msg.data[1]</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment"># for h/w interface to call server service.</span></div><div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="classjoints__receive__from__arduino_1_1Wheel__state.html#a31ec29ae54daf3088a5a08b9a75df3e0">   36</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html#a31ec29ae54daf3088a5a08b9a75df3e0">my_server</a>(self, req):</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <span class="keyword">global</span> pos, vel</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        res = joint_stateResponse() </div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        res.pos1=self.<a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html#aa20810461ad5601538d8c19e58c0c227">pos0</a></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        res.vel1=self.<a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html#a5b5c162bf840b6a0326d1caf18f1d473">vel0</a></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        res.pos2=self.<a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html#a4715509e5c522908410eee97a6267317">pos1</a></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        res.vel2=self.<a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html#a236f5e16a2e10b4461011a862a245eda">vel1</a></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        res.success = <span class="keyword">True</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="keywordflow">return</span> res</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="classjoints__receive__from__arduino_1_1Wheel__state.html#a7704c5b720ecd045272650ed7932699c">   46</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html#a7704c5b720ecd045272650ed7932699c">main</a>(self): </div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="comment"># joint_state is the file name of srv; client is read method in h/w interface</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        rospy.Service(<span class="stringliteral">&#39;read_joint_state&#39;</span>, joint_state, self.<a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html#a31ec29ae54daf3088a5a08b9a75df3e0">my_server</a>)</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        rospy.loginfo(<span class="stringliteral">&#39;joint state service is available for h/w interface&#39;</span>)</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="comment"># spin() simply keeps python from exiting until this node is stopped</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        rospy.spin()        </div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="stringliteral">pos=[0,0]</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="stringliteral">vel=[0,0]</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="stringliteral"># msg from arduino coz we subscribe /joint_states_from_arduino</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="stringliteral">def my_callback(msg):</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="stringliteral">    global pos, vel  </span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="stringliteral">    pos[0]=msg.data[0]</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="stringliteral">    vel[0]=msg.data[1]</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="stringliteral">    # pos[1]=msg[1].data[0]</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="stringliteral">    # vel[1]=msg[1].data[1]</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="stringliteral">    #print &quot;Pos: &quot;, pos, &quot;vel: &quot;, vel</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="stringliteral">    #rospy.loginfo(rospy.get_caller_id() + &quot;I heard %s&quot;, msg)</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="stringliteral"># for h/w interface to call server service.</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="stringliteral">def my_server(req):</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="stringliteral">    global pos, vel</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="stringliteral">    res = joint_stateResponse() </span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="stringliteral">    res.pos1=pos[0]</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="stringliteral">    res.vel1=vel[0]</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="stringliteral">    res.pos2=pos[1]</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="stringliteral">    res.vel2=vel[1]</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="stringliteral">    res.success = True</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="stringliteral">    return res</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="stringliteral">def main():</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="stringliteral">    rospy.init_node(&#39;subscriber_py&#39;, anonymous=True) #initialzing the node with name &quot;subscriber_py&quot;</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="stringliteral">    rospy.Subscriber(&quot;/joint_states_from_arduino&quot;, Floats, my_callback, queue_size=10)</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="stringliteral"> </span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="stringliteral">    # joint_state is the file name of srv; client is read method in h/w interface</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="stringliteral">    rospy.Service(&#39;read_joint_state&#39;, joint_state, my_server)</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="stringliteral">    rospy.loginfo(&#39;joint state service is available for h/w interface&#39;)</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="stringliteral">    # spin() simply keeps python from exiting until this node is stopped</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="stringliteral">    rospy.spin() </span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="keywordflow">if</span> __name__ == <span class="stringliteral">&#39;__main__&#39;</span>:</div><div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="namespacejoints__receive__from__arduino.html#a75b7771d9c4770fe3171a1d58604e5ae">   90</a></span>&#160;    wheel_state = <a class="code" href="classjoints__receive__from__arduino_1_1Wheel__state.html">Wheel_state</a>()</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    wheel_state.main()</div><div class="ttc" id="classjoints__receive__from__arduino_1_1Wheel__state_html_a31ec29ae54daf3088a5a08b9a75df3e0"><div class="ttname"><a href="classjoints__receive__from__arduino_1_1Wheel__state.html#a31ec29ae54daf3088a5a08b9a75df3e0">joints_receive_from_arduino.Wheel_state.my_server</a></div><div class="ttdeci">def my_server(self, req)</div><div class="ttdef"><b>Definition:</b> <a href="joints__receive__from__arduino_8py_source.html#l00036">joints_receive_from_arduino.py:36</a></div></div>
<div class="ttc" id="classjoints__receive__from__arduino_1_1Wheel__state_html_a5b5c162bf840b6a0326d1caf18f1d473"><div class="ttname"><a href="classjoints__receive__from__arduino_1_1Wheel__state.html#a5b5c162bf840b6a0326d1caf18f1d473">joints_receive_from_arduino.Wheel_state.vel0</a></div><div class="ttdeci">vel0</div><div class="ttdef"><b>Definition:</b> <a href="joints__receive__from__arduino_8py_source.html#l00015">joints_receive_from_arduino.py:15</a></div></div>
<div class="ttc" id="classjoints__receive__from__arduino_1_1Wheel__state_html_af88751bc8cd5fcfd4d87268b4781a7a2"><div class="ttname"><a href="classjoints__receive__from__arduino_1_1Wheel__state.html#af88751bc8cd5fcfd4d87268b4781a7a2">joints_receive_from_arduino.Wheel_state.__init__</a></div><div class="ttdeci">def __init__(self)</div><div class="ttdef"><b>Definition:</b> <a href="joints__receive__from__arduino_8py_source.html#l00010">joints_receive_from_arduino.py:10</a></div></div>
<div class="ttc" id="classjoints__receive__from__arduino_1_1Wheel__state_html_a7704c5b720ecd045272650ed7932699c"><div class="ttname"><a href="classjoints__receive__from__arduino_1_1Wheel__state.html#a7704c5b720ecd045272650ed7932699c">joints_receive_from_arduino.Wheel_state.main</a></div><div class="ttdeci">def main(self)</div><div class="ttdef"><b>Definition:</b> <a href="joints__receive__from__arduino_8py_source.html#l00046">joints_receive_from_arduino.py:46</a></div></div>
<div class="ttc" id="classjoints__receive__from__arduino_1_1Wheel__state_html_a53794f24feed2a9458936721af719988"><div class="ttname"><a href="classjoints__receive__from__arduino_1_1Wheel__state.html#a53794f24feed2a9458936721af719988">joints_receive_from_arduino.Wheel_state.joint1_callback</a></div><div class="ttdeci">def joint1_callback(self, msg)</div><div class="ttdef"><b>Definition:</b> <a href="joints__receive__from__arduino_8py_source.html#l00019">joints_receive_from_arduino.py:19</a></div></div>
<div class="ttc" id="classjoints__receive__from__arduino_1_1Wheel__state_html"><div class="ttname"><a href="classjoints__receive__from__arduino_1_1Wheel__state.html">joints_receive_from_arduino.Wheel_state</a></div><div class="ttdef"><b>Definition:</b> <a href="joints__receive__from__arduino_8py_source.html#l00009">joints_receive_from_arduino.py:9</a></div></div>
<div class="ttc" id="classjoints__receive__from__arduino_1_1Wheel__state_html_aa20810461ad5601538d8c19e58c0c227"><div class="ttname"><a href="classjoints__receive__from__arduino_1_1Wheel__state.html#aa20810461ad5601538d8c19e58c0c227">joints_receive_from_arduino.Wheel_state.pos0</a></div><div class="ttdeci">pos0</div><div class="ttdef"><b>Definition:</b> <a href="joints__receive__from__arduino_8py_source.html#l00014">joints_receive_from_arduino.py:14</a></div></div>
<div class="ttc" id="classjoints__receive__from__arduino_1_1Wheel__state_html_a4715509e5c522908410eee97a6267317"><div class="ttname"><a href="classjoints__receive__from__arduino_1_1Wheel__state.html#a4715509e5c522908410eee97a6267317">joints_receive_from_arduino.Wheel_state.pos1</a></div><div class="ttdeci">pos1</div><div class="ttdef"><b>Definition:</b> <a href="joints__receive__from__arduino_8py_source.html#l00014">joints_receive_from_arduino.py:14</a></div></div>
<div class="ttc" id="classjoints__receive__from__arduino_1_1Wheel__state_html_a236f5e16a2e10b4461011a862a245eda"><div class="ttname"><a href="classjoints__receive__from__arduino_1_1Wheel__state.html#a236f5e16a2e10b4461011a862a245eda">joints_receive_from_arduino.Wheel_state.vel1</a></div><div class="ttdeci">vel1</div><div class="ttdef"><b>Definition:</b> <a href="joints__receive__from__arduino_8py_source.html#l00015">joints_receive_from_arduino.py:15</a></div></div>
</div><!-- fragment --></div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/diff_drive">diff_drive</a><br />
Author(s): </br />
<small>autogenerated on Tue Feb 16 2021 17:30:31</small>
</div>
</body>
</html>
